// Containers (from env, or placeholder)
params.pb_container   = System.getenv('PB_SIF')   ?: '/path/to/parabricks.sif'
params.gatk_container = System.getenv('GATK_SIF') ?: '/path/to/gatk.sif'

// Optional Slurm account via env/param, but default to blank in public
params.slurm_account = System.getenv('SLURM_ACCOUNT') ?: ''

profiles {
  slurm {
    process {
      executor = 'slurm'

        withLabel: 'gpu' {
          queue     = System.getenv('SLURM_GPU_PARTITION') ?: 'gpu'
          cpus      = 40
          memory    = '150 GB'
          container = params.pb_container

          // Request N GPUs, no type
          clusterOptions = (
            (params.slurm_account ? "--account ${params.slurm_account} " : "") +
            "--partition=${queue} --ntasks=1 --cpus-per-task=${cpus} " +
            "--gres=gpu:${params.num_gpus}"
          )

          // GPU passthrough to Apptainer
          containerOptions = '--nv'
          maxForks = 2
        }
        
        withLabel: 'cpu' {
        queue = System.getenv('SLURM_CPU_PARTITION') ?: 'compute'
        cpus = 32
        memory = '200 GB'
        container = params.gatk_container
        clusterOptions = params.slurm_account ? "--account ${params.slurm_account}" : ''
        containerOptions = '--nv'
        maxForks = 6
      }
    }


    singularity.enabled    = true
    singularity.autoMounts = true
    // Let users define binds at runtime (env) rather than committing your cluster paths
    singularity.runOptions = (System.getenv('SINGULARITY_RUN_OPTS') ?: '--nv')
  }
}
